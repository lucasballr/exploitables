# Use a base image of Debian
FROM debian:latest

# Set environment variables to avoid user interaction during package installation
ENV DEBIAN_FRONTEND=noninteractive

# Update package lists and install build dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    wget \
    libpam0g-dev \
    libssl-dev \
    fakeroot \
    && rm -rf /var/lib/apt/lists/*

# Download the source code of the specific version of sudo you want to compile
RUN wget https://www.sudo.ws/dist/sudo-1.8.28.tar.gz \
    && tar -xzf sudo-1.8.28.tar.gz \
    && rm sudo-1.8.28.tar.gz

# Change directory into the extracted source code directory
WORKDIR /sudo-1.8.28

# Configure, make, and install sudo
RUN ./configure && make && make install

# Cleanup unnecessary files and clear cache to reduce image size
RUN apt-get purge -y --auto-remove build-essential wget libpam0g-dev libssl-dev fakeroot \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/* /sudo-1.8.28

# Create a new user 'testuser'
RUN useradd -m testuser

# Switch to the new user's home directory
WORKDIR /home/testuser

# Copy the example.txt file to the new user's home directory
COPY privesc.sh .
COPY sudoers /etc/sudoers

# Change ownership of the copied file to the new user
RUN chown testuser:testuser privesc.sh

# Set the default command or entrypoint (optional)
USER testuser
CMD ["/bin/bash"]

