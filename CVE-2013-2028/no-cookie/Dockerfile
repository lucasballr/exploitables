# Use a base image of Debian
FROM ubuntu:16.04
# FROM ubuntu:22.04

# Set environment variables to avoid user interaction during package installation
# ENV DEBIAN_FRONTEND=noninteractive

# Update package lists and install build dependencies
# Nginx dependencies may include libraries for compression, SSL support, and more
RUN apt update && apt install -y software-properties-common
RUN add-apt-repository ppa:deadsnakes/ppa
RUN apt-get update && apt-get install -y \
    build-essential \
    libpcre3-dev \
    zlib1g-dev \
    libssl-dev \
    libffi-dev \
    libncurses5-dev \
    aptitude \
    procps \
    gdb \
    git \
    vim \
    wget \
    tmux \
    strace \
    && rm -rf /var/lib/apt/lists/*

RUN aptitude install libglib2.0-dev
# Download the source code of Nginx version 1.3.9
RUN wget http://nginx.org/download/nginx-1.3.9.tar.gz \
    && tar -xzvf nginx-1.3.9.tar.gz \
    && rm nginx-1.3.9.tar.gz

RUN wget https://www.python.org/ftp/python/3.8.0/Python-3.8.0.tgz \
    && tar -xf Python-3.8.0.tgz

WORKDIR /Python-3.8.0
RUN ./configure --enable-optimizations \
    && make -j 8 \
    && make altinstall

WORKDIR /nginx-1.3.9
# Configure the build options for Nginx, then compile and install
RUN ./configure --without-http_rewrite_module --without-http_gzip_module
COPY ./Makefile /nginx-1.3.9/objs/
RUN make -j4\
    && make install

RUN wget https://bootstrap.pypa.io/get-pip.py && python3.8 get-pip.py

WORKDIR /root
RUN wget -P ~ https://github.com/cyrus-and/gdb-dashboard/raw/master/.gdbinit
RUN python3.8 -m pip install --upgrade pip
# RUN git clone https://github.com/Gallopsled/pwntools
RUN python3.8 -m pip install --upgrade pwntools
COPY ./e.py /root/

# Expose port 80 for the web server
EXPOSE 80

# Start Nginx in the foreground so the container doesn't immediately exit
# CMD ["/usr/local/nginx/sbin/nginx", "-g", "daemon off;"]
CMD ["/bin/bash"]
