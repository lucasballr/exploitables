# Use a Debian base image
FROM debian:latest

# Set environment variables to avoid user interaction during package installation
ENV DEBIAN_FRONTEND=noninteractive

# Install necessary build dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    python3 \
    python3-pip \
    python3-venv \
    gdb \
    wget \
    strace \
    git \
    vim \
    locales

######################################################
##### INSTALL / COMPILE VULNERABLE PROGRAM HERE ######
######################################################

# Download and install pwndbg
RUN wget https://github.com/pwndbg/pwndbg/releases/download/2024.02.14/pwndbg_2024.02.14_amd64-portable.tar.gz
RUN tar -v -xf pwndbg_2024.02.14_amd64-portable.tar.gz
RUN ln -s /pwndbg/bin/pwndbg /bin/pwndbg

# Setup venv for pip and install pwntools
RUN python3 -m venv venv
RUN /venv/bin/pip install --upgrade pip
RUN echo "source /venv/bin/activate" >> ~/.bashrc
RUN /venv/bin/pip install pwntools

# Set up locale information for debugging issues
RUN sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen && \
    locale-gen
ENV LANG en_US.UTF-8
ENV LANGUAGE en_US:en
ENV LC_ALL en_US.UTF-8

# Start command for when the container starts 
CMD ["/bin/bash"]
