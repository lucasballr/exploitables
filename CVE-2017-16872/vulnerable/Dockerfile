# Use a Debian base image
FROM debian:buster

# Set environment variables to avoid user interaction during package installation
ENV DEBIAN_FRONTEND=noninteractive

# Install necessary build dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    automake \
    autoconf \
    libtool \
    libasound2-dev \
    libpulse-dev \
    libssl-dev \
    libopus-dev \
    libvpx-dev \
    libspeex-dev \
    libgsm1-dev \
    python3 \
    gdb \
    wget \
    strace \
    git \
    vim \
    locales \
    && rm -rf /var/lib/apt/lists/ 

RUN wget https://github.com/pwndbg/pwndbg/releases/download/2024.02.14/pwndbg_2024.02.14_amd64-portable.tar.gz
RUN tar -v -xf pwndbg_2024.02.14_amd64-portable.tar.gz
RUN ln -s /pwndbg/bin/pwndbg /bin/pwndbg

# ENV CFLAGS="-fsanitize=address -fno-omit-frame-pointer -O1"
# ENV LDFLAGS="-fsanitize=address"

RUN wget https://github.com/pjsip/pjproject/archive/refs/tags/2.7.tar.gz
RUN tar -xvf /2.7.tar.gz && \
    cd pjproject-2.7 && \
    CFLAGS='-g' LDFLAGS="-g" ./configure && \
    make dep && make clean && make && make install

WORKDIR /pjproject-2.7
RUN ldconfig
WORKDIR /

EXPOSE 5060/udp
# Set the locale
RUN sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen && \
    locale-gen
ENV LANG en_US.UTF-8
ENV LANGUAGE en_US:en
ENV LC_ALL en_US.UTF-8


# CMD ["./pjsua-x86_64-unknown-linux-gnu"]
CMD ["/bin/bash"]
